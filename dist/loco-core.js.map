{"version":3,"file":"loco-core.js","mappings":"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","sources":["webpack://LocoCore/webpack/universalModuleDefinition","webpack://LocoCore/webpack/bootstrap","webpack://LocoCore/webpack/runtime/define property getters","webpack://LocoCore/webpack/runtime/hasOwnProperty shorthand","webpack://LocoCore/webpack/runtime/make namespace object","webpack://LocoCore/./src/init.js","webpack://LocoCore/./src/helpers.js","webpack://LocoCore/./src/start/id.js","webpack://LocoCore/./src/start/observer.js","webpack://LocoCore/./src/start.js","webpack://LocoCore/./src/start/scan.js","webpack://LocoCore/./src/start/init.js","webpack://LocoCore/./src/start/warnings.js","webpack://LocoCore/./src/component.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"LocoCore\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"LocoCore\"] = factory();\n\telse\n\t\troot[\"LocoCore\"] = factory();\n})(window, function() {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","let namespaceController = null;\nlet controller = null;\n\nconst callFunc = (resource, name) => {\n  if (typeof resource.constructor[name] === \"function\") {\n    resource.constructor[name]();\n  }\n  if (typeof resource[name] === \"function\") {\n    resource[name]();\n  }\n};\n\nconst getController = (Controllers, name, subName) => {\n  const resource =\n    subName === undefined ? Controllers[name] : Controllers[name][subName];\n  if (typeof resource === \"function\") {\n    return new resource();\n  } else if (typeof resource === \"object\") {\n    return resource;\n  }\n  return null;\n};\n\nconst init = (Controllers) => {\n  const body = document.getElementsByTagName(\"body\")[0];\n  const namespaceName = body.getAttribute(\"data-namespace\");\n  const controllerName = body.getAttribute(\"data-controller\");\n  const actionName = body.getAttribute(\"data-action\");\n\n  if (controller !== null) {\n    callFunc(controller, \"deinitialize\");\n    controller = null;\n  }\n  if (namespaceController !== null) {\n    callFunc(namespaceController, \"deinitialize\");\n    namespaceController = null;\n  }\n\n  namespaceController = getController(Controllers, namespaceName);\n  controller = getController(Controllers, controllerName);\n\n  if (namespaceController !== null) {\n    controller = getController(Controllers, namespaceName, controllerName);\n    namespaceController.controller = controller;\n    callFunc(namespaceController, \"initialize\");\n  }\n  if (controller !== null) {\n    controller.namespaceController = namespaceController;\n    callFunc(controller, \"initialize\");\n    callFunc(controller, actionName);\n  }\n\n  return { namespaceController, controller, action: actionName };\n};\n\nexport default init;\n","const fetchParams = (url = window.location.href) => {\n  const params = {};\n  const match = /https?:\\/\\/.+\\/\\w+\\/(\\d+)/.exec(url);\n  const id = match !== null ? match[1] : null;\n  if (id !== null) {\n    params[\"id\"] = parseInt(id);\n  }\n  const splitUrl = url.split(\"?\");\n  if (splitUrl.length === 1) return params;\n  const paramsString = splitUrl[splitUrl.length - 1];\n  const paramsArray = paramsString.split(\"&\").map((s) => s.split(\"=\"));\n  for (const arr of paramsArray) {\n    let key = decodeURIComponent(arr[0]);\n    let val = decodeURIComponent(arr[1]);\n    if (typeof val === \"string\") {\n      val = val.replace(/\\+/g, \" \");\n    }\n    params[key] = val;\n  }\n  return params;\n};\n\nexport default {\n  get params() {\n    return fetchParams();\n  },\n};\n","let componentIdCounter = 1;\nexport const generateComponentId = () => `${componentIdCounter++}`;\n","import { generateComponentId } from \"./id\";\n\nconst rootToObserver = new WeakMap(); // Element -> { observer, classByName }\n\nexport const ensureObservation = (searchRoot, componentClasses) => {\n  const classByName = new Map();\n  if (rootToObserver.has(searchRoot)) {\n    const existing = rootToObserver.get(searchRoot);\n    existing.classByName.forEach((v, k) => classByName.set(k, v));\n  }\n  for (const ComponentClass of componentClasses) {\n    const name =\n      typeof ComponentClass?.name === \"string\" ? ComponentClass.name : null;\n    if (name) classByName.set(name, ComponentClass);\n  }\n\n  if (rootToObserver.has(searchRoot)) {\n    const entry = rootToObserver.get(searchRoot);\n    entry.classByName = classByName;\n    return;\n  }\n\n  const observer = new MutationObserver((mutations) => {\n    const added = new Set();\n    for (const m of mutations) {\n      for (const node of m.addedNodes) {\n        if (!(node instanceof Element)) continue;\n        if (node.hasAttribute(\"data-component\")) added.add(node);\n        node\n          .querySelectorAll?.(\"[data-component]\")\n          .forEach((el) => added.add(el));\n      }\n    }\n\n    if (added.size === 0) return;\n\n    const candidates = Array.from(added).filter((el) => {\n      const name = el.getAttribute(\"data-component\");\n      return classByName.has(name) && !el.instance;\n    });\n    if (candidates.length === 0) return;\n\n    const elementToInstance = new Map();\n    for (const el of candidates) {\n      const name = el.getAttribute(\"data-component\");\n      const ComponentClass = classByName.get(name);\n      if (!ComponentClass) continue;\n      const instance = new ComponentClass();\n      instance.element = el;\n      instance.node = { parent: null, children: [] };\n      instance.componentId = generateComponentId();\n      el.setAttribute(\"data-component-id\", instance.componentId);\n      el.instance = instance;\n      elementToInstance.set(el, instance);\n    }\n\n    for (const el of candidates) {\n      const instance = elementToInstance.get(el);\n      if (!instance) continue;\n      const parentEl = el.parentElement?.closest(\"[data-component]\");\n      if (parentEl) {\n        const parentInstance =\n          elementToInstance.get(parentEl) || parentEl.instance;\n        if (parentInstance && parentInstance.node) {\n          instance.node.parent = parentInstance.node;\n          parentInstance.node.children.push(instance.node);\n        }\n      }\n      for (const child of candidates) {\n        if (child === el) continue;\n        const nearest = child.parentElement?.closest(\"[data-component]\");\n        if (nearest === el) {\n          const childInstance = elementToInstance.get(child);\n          if (childInstance) {\n            instance.node.children.push(childInstance.node);\n            childInstance.node.parent = instance.node;\n          }\n        }\n      }\n    }\n\n    for (const instance of elementToInstance.values()) {\n      if (typeof instance.connect === \"function\") instance.connect();\n    }\n  });\n\n  observer.observe(searchRoot, { childList: true, subtree: true });\n  rootToObserver.set(searchRoot, { observer, classByName });\n};\n","import { warnMissingDomComponents } from \"./start/warnings\";\n\nimport {\n  resolveSearchRoot,\n  scanComponentElements,\n  buildElementTree,\n} from \"./start/scan\";\nimport { initializeMatches } from \"./start/init\";\nimport { ensureObservation } from \"./start/observer\";\n\nconst start = (options = {}) => {\n  const providedRoot = options.root ?? document;\n  const componentClasses = Array.isArray(options.components)\n    ? options.components\n    : [];\n  // Build a fresh components tree on every call\n  const components = [];\n\n  // Determine the search root (document.body if a Document is provided)\n  const searchRoot = resolveSearchRoot(providedRoot);\n\n  // Find all component elements within the search root\n  const componentElements = scanComponentElements(searchRoot);\n\n  // Create a node for each element upfront so parent/child linking doesn't depend on order\n  const { elementToNode } = buildElementTree(componentElements);\n  // roots are not needed from here; tests expect return to be an array of root nodes\n  components.push(\n    ...Array.from(elementToNode.values()).filter((n) => n.parent === null),\n  );\n\n  // Initialize provided component classes (if any)\n  // Initialize instances for matching nodes\n  initializeMatches(elementToNode, componentClasses);\n\n  warnMissingDomComponents(componentElements, componentClasses);\n\n  // Begin observing for dynamically added components within this root\n  ensureObservation(searchRoot, componentClasses);\n\n  return components;\n};\n\nexport default start;\n","export const resolveSearchRoot = (providedRoot) => {\n  return providedRoot && providedRoot.body ? providedRoot.body : providedRoot;\n};\n\nexport const scanComponentElements = (searchRoot) => {\n  const componentElements = Array.from(\n    searchRoot.querySelectorAll(\"[data-component]\"),\n  );\n  if (\n    searchRoot instanceof Element &&\n    searchRoot.hasAttribute(\"data-component\") &&\n    !componentElements.includes(searchRoot)\n  ) {\n    componentElements.unshift(searchRoot);\n  }\n  return componentElements;\n};\n\nexport const buildElementTree = (componentElements) => {\n  const components = [];\n  const elementToNode = new Map();\n  for (const element of componentElements) {\n    const name = element.getAttribute(\"data-component\");\n    elementToNode.set(element, {\n      name,\n      element,\n      parent: null,\n      children: [],\n    });\n  }\n  for (const element of componentElements) {\n    const node = elementToNode.get(element);\n    const parentElement = element.parentElement?.closest(\"[data-component]\");\n    if (parentElement && elementToNode.has(parentElement)) {\n      const parentNode = elementToNode.get(parentElement);\n      node.parent = parentNode;\n      parentNode.children.push(node);\n    } else {\n      components.push(node);\n    }\n  }\n  return { components, elementToNode };\n};\n","import { generateComponentId } from \"./id\";\n\nexport const initializeMatches = (elementToNode, componentClasses) => {\n  for (const ComponentClass of componentClasses) {\n    const componentName =\n      typeof ComponentClass?.name === \"string\" ? ComponentClass.name : null;\n    if (!componentName) continue;\n\n    const matches = [];\n    for (const node of elementToNode.values()) {\n      if (node.name === componentName) matches.push(node);\n    }\n\n    for (const node of matches) {\n      const instance = new ComponentClass();\n      instance.element = node.element;\n      const sanitizedNode = { ...node };\n      delete sanitizedNode.name;\n      delete sanitizedNode.element;\n      instance.node = sanitizedNode;\n      instance.componentId = generateComponentId();\n      node.element.setAttribute(\"data-component-id\", instance.componentId);\n      node.element.instance = instance;\n      if (typeof instance.connect === \"function\") instance.connect();\n    }\n  }\n};\n","export const warnMissingDomComponents = (\n  componentElements,\n  componentClasses,\n) => {\n  if (!componentElements || componentElements.length === 0) return;\n\n  const domNames = new Set(\n    Array.from(componentElements, (el) => el.getAttribute(\"data-component\")),\n  );\n  const providedNames = new Set(\n    (Array.isArray(componentClasses) ? componentClasses : [])\n      .map((C) => (typeof C?.name === \"string\" ? C.name : null))\n      .filter(Boolean),\n  );\n\n  for (const name of domNames) {\n    if (!providedNames.has(name)) {\n      console.warn(\n        `Found data-component=\"${name}\" but no matching class passed to start({ components })`,\n      );\n    }\n  }\n};\n","export default class Component {\n  constructor() {\n    this._cleanupCallbacks = [];\n    this._isDisconnected = false;\n  }\n\n  registerCleanup(callback) {\n    if (typeof callback === \"function\") this._cleanupCallbacks.push(callback);\n    return callback;\n  }\n\n  on(target, type, listener, options) {\n    target.addEventListener(type, listener, options);\n    const off = () => target.removeEventListener(type, listener, options);\n    this.registerCleanup(off);\n    return off;\n  }\n\n  timeout(callback, delay) {\n    const id = setTimeout(callback, delay);\n    this.registerCleanup(() => clearTimeout(id));\n    return id;\n  }\n\n  interval(callback, delay) {\n    const id = setInterval(callback, delay);\n    this.registerCleanup(() => clearInterval(id));\n    return id;\n  }\n\n  disconnect() {\n    if (this._isDisconnected) return;\n    this._isDisconnected = true;\n    const callbacks = this._cleanupCallbacks.splice(0);\n    for (const cleanup of callbacks) cleanup();\n  }\n\n  ref(name) {\n    const list = Array.from(\n      this.element.querySelectorAll(`[data-ref=\"${name}\"]`),\n    );\n    if (list.length === 0) return [];\n    if (list.length === 1) return list[0];\n    return list;\n  }\n\n  refs() {\n    const temp = {};\n    const elements = this.element.querySelectorAll(\"[data-ref]\");\n    elements.forEach((el) => {\n      const key = el.getAttribute(\"data-ref\");\n      if (!temp[key]) temp[key] = [];\n      temp[key].push(el);\n    });\n    const result = {};\n    Object.keys(temp).forEach((key) => {\n      const arr = temp[key];\n      result[key] = arr.length === 1 ? arr[0] : arr;\n    });\n    return result;\n  }\n}\n"],"names":["root","factory","exports","module","define","amd","window","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","namespaceController","controller","callFunc","resource","name","constructor","getController","Controllers","subName","undefined","body","document","getElementsByTagName","namespaceName","getAttribute","controllerName","actionName","action","params","fetchParams","url","location","href","match","exec","id","parseInt","splitUrl","split","length","paramsArray","map","s","arr","decodeURIComponent","val","replace","componentIdCounter","generateComponentId","rootToObserver","WeakMap","start","options","providedRoot","componentClasses","Array","isArray","components","searchRoot","resolveSearchRoot","componentElements","from","querySelectorAll","Element","hasAttribute","includes","unshift","scanComponentElements","elementToNode","Map","element","set","parent","children","node","parentElement","closest","has","parentNode","push","buildElementTree","values","filter","n","initializeMatches","ComponentClass","componentName","matches","instance","sanitizedNode","componentId","setAttribute","connect","warnMissingDomComponents","domNames","Set","el","providedNames","C","Boolean","console","warn","ensureObservation","classByName","forEach","v","k","observer","MutationObserver","mutations","added","m","addedNodes","add","size","candidates","elementToInstance","parentEl","parentInstance","child","nearest","childInstance","observe","childList","subtree","Component","this","_cleanupCallbacks","_isDisconnected","registerCleanup","callback","on","target","type","listener","addEventListener","off","removeEventListener","timeout","delay","setTimeout","clearTimeout","interval","setInterval","clearInterval","disconnect","callbacks","splice","cleanup","ref","list","refs","temp","result","keys"],"sourceRoot":""}