{"version":3,"file":"loco-core.js","mappings":"CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,IACQ,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,WAAY,GAAIH,GACG,iBAAZC,QACdA,QAAkB,SAAID,IAEtBD,EAAe,SAAIC,GACpB,CATD,CASGK,OAAQ,WACX,O,wBCTA,IAAIC,EAAsB,CCA1BA,EAAwB,SAASL,EAASM,GACzC,IAAI,IAAIC,KAAOD,EACXD,EAAoBG,EAAEF,EAAYC,KAASF,EAAoBG,EAAER,EAASO,IAC5EE,OAAOC,eAAeV,EAASO,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAG3E,ECPAF,EAAwB,SAASQ,EAAKC,GAAQ,OAAOL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,EAAO,ECCtGT,EAAwB,SAASL,GACX,oBAAXkB,QAA0BA,OAAOC,aAC1CV,OAAOC,eAAeV,EAASkB,OAAOC,YAAa,CAAEC,MAAO,WAE7DX,OAAOC,eAAeV,EAAS,aAAc,CAAEoB,OAAO,GACvD,G,sICNA,IAAIC,EAAsB,KACtBC,EAAa,KAEjB,MAAMC,EAAWA,CAACC,EAAUC,KACgB,mBAA/BD,EAASE,YAAYD,IAC9BD,EAASE,YAAYD,KAEO,mBAAnBD,EAASC,IAClBD,EAASC,MAIPE,EAAgBA,CAACC,EAAaH,EAAMI,KACxC,MAAML,OACQM,IAAZD,EAAwBD,EAAYH,GAAQG,EAAYH,GAAMI,GAChE,MAAwB,mBAAbL,EACF,IAAIA,EACkB,iBAAbA,EACTA,EAEF,MAmCT,MAhCcI,IACZ,MAAMG,EAAOC,SAASC,qBAAqB,QAAQ,GAC7CC,EAAgBH,EAAKI,aAAa,kBAClCC,EAAiBL,EAAKI,aAAa,mBACnCE,EAAaN,EAAKI,aAAa,eAyBrC,OAvBmB,OAAfb,IACFC,EAASD,EAAY,gBACrBA,EAAa,MAEa,OAAxBD,IACFE,EAASF,EAAqB,gBAC9BA,EAAsB,MAGxBA,EAAsBM,EAAcC,EAAaM,GACjDZ,EAAaK,EAAcC,EAAaQ,GAEZ,OAAxBf,IACFC,EAAaK,EAAcC,EAAaM,EAAeE,GACvDf,EAAoBC,WAAaA,EACjCC,EAASF,EAAqB,eAEb,OAAfC,IACFA,EAAWD,oBAAsBA,EACjCE,EAASD,EAAY,cACrBC,EAASD,EAAYe,IAGhB,CAAEhB,sBAAqBC,aAAYgB,OAAQD,IC9BpD,GACE,UAAIE,GACF,MAxBgBC,EAACC,EAAMrC,OAAOsC,SAASC,QACzC,MAAMJ,EAAS,CAAC,EACVK,EAAQ,4BAA4BC,KAAKJ,GACzCK,EAAe,OAAVF,EAAiBA,EAAM,GAAK,KAC5B,OAAPE,IACFP,EAAW,GAAIQ,SAASD,IAE1B,MAAME,EAAWP,EAAIQ,MAAM,KAC3B,GAAwB,IAApBD,EAASE,OAAc,OAAOX,EAClC,MACMY,EADeH,EAASA,EAASE,OAAS,GACfD,MAAM,KAAKG,IAAKC,GAAMA,EAAEJ,MAAM,MAC/D,IAAK,MAAMK,KAAOH,EAAa,CAC7B,IAAI5C,EAAMgD,mBAAmBD,EAAI,IAC7BE,EAAMD,mBAAmBD,EAAI,IACd,iBAARE,IACTA,EAAMA,EAAIC,QAAQ,MAAO,MAE3BlB,EAAOhC,GAAOiD,CAChB,CACA,OAAOjB,GAKEC,EACT,GCzBK,MAAMkB,EAAyBC,IACpC,MAAMC,EACJD,GACAA,EAAe5C,WACf4C,EAAe5C,UAAUW,YACrBiC,EAAe5C,UAAUW,YAAYD,KACrC,cAENoC,QAAQC,KACN,mBAAmBF,qECJvB,IAAIG,EAAqB,EACzB,MAAMC,EAAsBA,IAAM,GAAGD,IAwFrC,MAtFcE,CAACC,EAAU,CAAC,KACxB,MAAMC,EAAeD,EAAQpE,MAAQkC,SAC/BoC,EAAmBC,MAAMC,QAAQJ,EAAQK,YAC3CL,EAAQK,WACR,GAEEA,EAAa,GAGbC,EACJL,GAAgBA,EAAapC,KAAOoC,EAAapC,KAAOoC,EAGpDM,EAAoBJ,MAAMK,KAC9BF,EAAWG,iBAAiB,qBAI5BH,aAAsBI,SACtBJ,EAAWK,aAAa,oBACvBJ,EAAkBK,SAASN,IAE5BC,EAAkBM,QAAQP,GAI5B,MAAMQ,EAAgB,IAAIC,IAC1B,IAAK,MAAMC,KAAWT,EAAmB,CACvC,MAAMhD,EAAOyD,EAAQ/C,aAAa,kBAClC6C,EAAcG,IAAID,EAAS,CACzBzD,OACAyD,UACAE,OAAQ,KACRC,SAAU,IAEd,CAGA,IAAK,MAAMH,KAAWT,EAAmB,CACvC,MAAMa,EAAON,EAAcpE,IAAIsE,GACzBK,EAAgBL,EAAQK,eAAeC,QAAQ,oBACrD,GAAID,GAAiBP,EAAcS,IAAIF,GAAgB,CACrD,MAAMG,EAAaV,EAAcpE,IAAI2E,GACrCD,EAAKF,OAASM,EACdA,EAAWL,SAASM,KAAKL,EAC3B,MACEf,EAAWoB,KAAKL,EAEpB,CAGA,IAAK,MAAM3B,KAAkBS,EAAkB,CAE7C,MAAMwB,EAC4B,iBAAzBjC,GAAgBlC,KAAoBkC,EAAelC,KAAO,KACnE,IAAKmE,EAAe,CAClBlC,EAAsBC,GACtB,QACF,CAEA,MAAMkC,EAAU,GAChB,IAAK,MAAMP,KAAQN,EAAcc,SAC3BR,EAAK7D,OAASmE,GAAeC,EAAQF,KAAKL,GAGhD,IAAK,MAAMA,KAAQO,EAAS,CAC1B,MAAME,EAAW,IAAIpC,EACrBoC,EAASb,QAAUI,EAAKJ,QAExB,MAAMc,EAAgB,IAAKV,UACpBU,EAAcvE,YACduE,EAAcd,QACrBa,EAAST,KAAOU,EAChBD,EAASE,YAAcjC,IACvBsB,EAAKJ,QAAQgB,aAAa,oBAAqBH,EAASE,aAExDX,EAAKJ,QAAQa,SAAWA,EACQ,mBAArBA,EAASI,SAAwBJ,EAASI,SACvD,CACF,CAIA,MD9EsCC,EACtC3B,EACAL,KAEA,IAAKK,GAAkD,IAA7BA,EAAkBvB,OAAc,OAE1D,MAAMmD,EAAW,IAAIC,IACnBjC,MAAMK,KAAKD,EAAoB8B,GAAOA,EAAGpE,aAAa,oBAElDqE,EAAgB,IAAIF,KACvBjC,MAAMC,QAAQF,GAAoBA,EAAmB,IACnDhB,IAAKqD,GAA0B,iBAAZA,GAAGhF,KAAoBgF,EAAEhF,KAAO,MACnDiF,OAAOC,UAGZ,IAAK,MAAMlF,KAAQ4E,EACZG,EAAcf,IAAIhE,IACrBoC,QAAQC,KACN,yBAAyBrC,6DC0D/B2E,CAAyB3B,EAAmBL,GAErCG,GC3FM,MAAMqC,EACnBlF,WAAAA,GACEmF,KAAKC,kBAAoB,GACzBD,KAAKE,iBAAkB,CACzB,CAEAC,eAAAA,CAAgBC,GAEd,MADwB,mBAAbA,GAAyBJ,KAAKC,kBAAkBnB,KAAKsB,GACzDA,CACT,CAEAC,EAAAA,CAAGC,EAAQC,EAAMC,EAAUnD,GACzBiD,EAAOG,iBAAiBF,EAAMC,EAAUnD,GACxC,MAAMqD,EAAMA,IAAMJ,EAAOK,oBAAoBJ,EAAMC,EAAUnD,GAE7D,OADA2C,KAAKG,gBAAgBO,GACdA,CACT,CAEAE,OAAAA,CAAQR,EAAUS,GAChB,MAAM5E,EAAK6E,WAAWV,EAAUS,GAEhC,OADAb,KAAKG,gBAAgB,IAAMY,aAAa9E,IACjCA,CACT,CAEA+E,QAAAA,CAASZ,EAAUS,GACjB,MAAM5E,EAAKgF,YAAYb,EAAUS,GAEjC,OADAb,KAAKG,gBAAgB,IAAMe,cAAcjF,IAClCA,CACT,CAEAkF,UAAAA,GACE,GAAInB,KAAKE,gBAAiB,OAC1BF,KAAKE,iBAAkB,EACvB,MAAMkB,EAAYpB,KAAKC,kBAAkBoB,OAAO,GAChD,IAAK,MAAMC,KAAWF,EAAWE,GACnC,CAEAC,GAAAA,CAAI3G,GACF,MAAM4G,EAAOhE,MAAMK,KACjBmC,KAAK3B,QAAQP,iBAAiB,cAAclD,QAE9C,OAAoB,IAAhB4G,EAAKnF,OAAqB,GACV,IAAhBmF,EAAKnF,OAAqBmF,EAAK,GAC5BA,CACT,CAEAC,IAAAA,GACE,MAAMC,EAAO,CAAC,EACG1B,KAAK3B,QAAQP,iBAAiB,cACtC6D,QAASjC,IAChB,MAAMhG,EAAMgG,EAAGpE,aAAa,YACvBoG,EAAKhI,KAAMgI,EAAKhI,GAAO,IAC5BgI,EAAKhI,GAAKoF,KAAKY,KAEjB,MAAMkC,EAAS,CAAC,EAKhB,OAJAhI,OAAOiI,KAAKH,GAAMC,QAASjI,IACzB,MAAM+C,EAAMiF,EAAKhI,GACjBkI,EAAOlI,GAAsB,IAAf+C,EAAIJ,OAAeI,EAAI,GAAKA,IAErCmF,CACT,E","sources":["webpack://LocoCore/webpack/universalModuleDefinition","webpack://LocoCore/webpack/bootstrap","webpack://LocoCore/webpack/runtime/define property getters","webpack://LocoCore/webpack/runtime/hasOwnProperty shorthand","webpack://LocoCore/webpack/runtime/make namespace object","webpack://LocoCore/./src/init.js","webpack://LocoCore/./src/helpers.js","webpack://LocoCore/./src/start/warnings.js","webpack://LocoCore/./src/start.js","webpack://LocoCore/./src/component.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"LocoCore\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"LocoCore\"] = factory();\n\telse\n\t\troot[\"LocoCore\"] = factory();\n})(window, function() {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","let namespaceController = null;\nlet controller = null;\n\nconst callFunc = (resource, name) => {\n  if (typeof resource.constructor[name] === \"function\") {\n    resource.constructor[name]();\n  }\n  if (typeof resource[name] === \"function\") {\n    resource[name]();\n  }\n};\n\nconst getController = (Controllers, name, subName) => {\n  const resource =\n    subName === undefined ? Controllers[name] : Controllers[name][subName];\n  if (typeof resource === \"function\") {\n    return new resource();\n  } else if (typeof resource === \"object\") {\n    return resource;\n  }\n  return null;\n};\n\nconst init = (Controllers) => {\n  const body = document.getElementsByTagName(\"body\")[0];\n  const namespaceName = body.getAttribute(\"data-namespace\");\n  const controllerName = body.getAttribute(\"data-controller\");\n  const actionName = body.getAttribute(\"data-action\");\n\n  if (controller !== null) {\n    callFunc(controller, \"deinitialize\");\n    controller = null;\n  }\n  if (namespaceController !== null) {\n    callFunc(namespaceController, \"deinitialize\");\n    namespaceController = null;\n  }\n\n  namespaceController = getController(Controllers, namespaceName);\n  controller = getController(Controllers, controllerName);\n\n  if (namespaceController !== null) {\n    controller = getController(Controllers, namespaceName, controllerName);\n    namespaceController.controller = controller;\n    callFunc(namespaceController, \"initialize\");\n  }\n  if (controller !== null) {\n    controller.namespaceController = namespaceController;\n    callFunc(controller, \"initialize\");\n    callFunc(controller, actionName);\n  }\n\n  return { namespaceController, controller, action: actionName };\n};\n\nexport default init;\n","const fetchParams = (url = window.location.href) => {\n  const params = {};\n  const match = /https?:\\/\\/.+\\/\\w+\\/(\\d+)/.exec(url);\n  const id = match !== null ? match[1] : null;\n  if (id !== null) {\n    params[\"id\"] = parseInt(id);\n  }\n  const splitUrl = url.split(\"?\");\n  if (splitUrl.length === 1) return params;\n  const paramsString = splitUrl[splitUrl.length - 1];\n  const paramsArray = paramsString.split(\"&\").map((s) => s.split(\"=\"));\n  for (const arr of paramsArray) {\n    let key = decodeURIComponent(arr[0]);\n    let val = decodeURIComponent(arr[1]);\n    if (typeof val === \"string\") {\n      val = val.replace(/\\+/g, \" \");\n    }\n    params[key] = val;\n  }\n  return params;\n};\n\nexport default {\n  get params() {\n    return fetchParams();\n  },\n};\n","export const warnMissingStaticName = (ComponentClass) => {\n  const ctorName =\n    ComponentClass &&\n    ComponentClass.prototype &&\n    ComponentClass.prototype.constructor\n      ? ComponentClass.prototype.constructor.name\n      : \"(anonymous)\";\n\n  console.warn(\n    `Component class ${ctorName} passed to start({ components }) should implement static \"name\"`,\n  );\n};\n\nexport const warnMissingDomComponents = (\n  componentElements,\n  componentClasses,\n) => {\n  if (!componentElements || componentElements.length === 0) return;\n\n  const domNames = new Set(\n    Array.from(componentElements, (el) => el.getAttribute(\"data-component\")),\n  );\n  const providedNames = new Set(\n    (Array.isArray(componentClasses) ? componentClasses : [])\n      .map((C) => (typeof C?.name === \"string\" ? C.name : null))\n      .filter(Boolean),\n  );\n\n  for (const name of domNames) {\n    if (!providedNames.has(name)) {\n      console.warn(\n        `Found data-component=\"${name}\" but no matching class passed to start({ components })`,\n      );\n    }\n  }\n};\n","import {\n  warnMissingStaticName,\n  warnMissingDomComponents,\n} from \"./start/warnings\";\n\nlet componentIdCounter = 1;\nconst generateComponentId = () => `${componentIdCounter++}`;\n\nconst start = (options = {}) => {\n  const providedRoot = options.root ?? document;\n  const componentClasses = Array.isArray(options.components)\n    ? options.components\n    : [];\n  // Build a fresh components tree on every call\n  const components = [];\n\n  // Determine the search root (document.body if a Document is provided)\n  const searchRoot =\n    providedRoot && providedRoot.body ? providedRoot.body : providedRoot;\n\n  // Find all component elements within the search root\n  const componentElements = Array.from(\n    searchRoot.querySelectorAll(\"[data-component]\"),\n  );\n  // Include the root itself if it is a component element\n  if (\n    searchRoot instanceof Element &&\n    searchRoot.hasAttribute(\"data-component\") &&\n    !componentElements.includes(searchRoot)\n  ) {\n    componentElements.unshift(searchRoot);\n  }\n\n  // Create a node for each element upfront so parent/child linking doesn't depend on order\n  const elementToNode = new Map();\n  for (const element of componentElements) {\n    const name = element.getAttribute(\"data-component\");\n    elementToNode.set(element, {\n      name,\n      element,\n      parent: null,\n      children: [],\n    });\n  }\n\n  // Link nodes into a tree based on the nearest ancestor component\n  for (const element of componentElements) {\n    const node = elementToNode.get(element);\n    const parentElement = element.parentElement?.closest(\"[data-component]\");\n    if (parentElement && elementToNode.has(parentElement)) {\n      const parentNode = elementToNode.get(parentElement);\n      node.parent = parentNode;\n      parentNode.children.push(node);\n    } else {\n      components.push(node);\n    }\n  }\n\n  // Initialize provided component classes (if any)\n  for (const ComponentClass of componentClasses) {\n    // Determine the component name to match (custom static field 'name' only)\n    const componentName =\n      typeof ComponentClass?.name === \"string\" ? ComponentClass.name : null;\n    if (!componentName) {\n      warnMissingStaticName(ComponentClass);\n      continue;\n    }\n\n    const matches = [];\n    for (const node of elementToNode.values()) {\n      if (node.name === componentName) matches.push(node);\n    }\n\n    for (const node of matches) {\n      const instance = new ComponentClass();\n      instance.element = node.element;\n      // Attach a sanitized view of the node without name/element keys\n      const sanitizedNode = { ...node };\n      delete sanitizedNode.name;\n      delete sanitizedNode.element;\n      instance.node = sanitizedNode;\n      instance.componentId = generateComponentId();\n      node.element.setAttribute(\"data-component-id\", instance.componentId);\n      // Expose the instance on the root element for this component\n      node.element.instance = instance;\n      if (typeof instance.connect === \"function\") instance.connect();\n    }\n  }\n\n  warnMissingDomComponents(componentElements, componentClasses);\n\n  return components;\n};\n\nexport default start;\n","export default class Component {\n  constructor() {\n    this._cleanupCallbacks = [];\n    this._isDisconnected = false;\n  }\n\n  registerCleanup(callback) {\n    if (typeof callback === \"function\") this._cleanupCallbacks.push(callback);\n    return callback;\n  }\n\n  on(target, type, listener, options) {\n    target.addEventListener(type, listener, options);\n    const off = () => target.removeEventListener(type, listener, options);\n    this.registerCleanup(off);\n    return off;\n  }\n\n  timeout(callback, delay) {\n    const id = setTimeout(callback, delay);\n    this.registerCleanup(() => clearTimeout(id));\n    return id;\n  }\n\n  interval(callback, delay) {\n    const id = setInterval(callback, delay);\n    this.registerCleanup(() => clearInterval(id));\n    return id;\n  }\n\n  disconnect() {\n    if (this._isDisconnected) return;\n    this._isDisconnected = true;\n    const callbacks = this._cleanupCallbacks.splice(0);\n    for (const cleanup of callbacks) cleanup();\n  }\n\n  ref(name) {\n    const list = Array.from(\n      this.element.querySelectorAll(`[data-ref=\"${name}\"]`),\n    );\n    if (list.length === 0) return [];\n    if (list.length === 1) return list[0];\n    return list;\n  }\n\n  refs() {\n    const temp = {};\n    const elements = this.element.querySelectorAll(\"[data-ref]\");\n    elements.forEach((el) => {\n      const key = el.getAttribute(\"data-ref\");\n      if (!temp[key]) temp[key] = [];\n      temp[key].push(el);\n    });\n    const result = {};\n    Object.keys(temp).forEach((key) => {\n      const arr = temp[key];\n      result[key] = arr.length === 1 ? arr[0] : arr;\n    });\n    return result;\n  }\n}\n"],"names":["root","factory","exports","module","define","amd","window","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","namespaceController","controller","callFunc","resource","name","constructor","getController","Controllers","subName","undefined","body","document","getElementsByTagName","namespaceName","getAttribute","controllerName","actionName","action","params","fetchParams","url","location","href","match","exec","id","parseInt","splitUrl","split","length","paramsArray","map","s","arr","decodeURIComponent","val","replace","warnMissingStaticName","ComponentClass","ctorName","console","warn","componentIdCounter","generateComponentId","start","options","providedRoot","componentClasses","Array","isArray","components","searchRoot","componentElements","from","querySelectorAll","Element","hasAttribute","includes","unshift","elementToNode","Map","element","set","parent","children","node","parentElement","closest","has","parentNode","push","componentName","matches","values","instance","sanitizedNode","componentId","setAttribute","connect","warnMissingDomComponents","domNames","Set","el","providedNames","C","filter","Boolean","Component","this","_cleanupCallbacks","_isDisconnected","registerCleanup","callback","on","target","type","listener","addEventListener","off","removeEventListener","timeout","delay","setTimeout","clearTimeout","interval","setInterval","clearInterval","disconnect","callbacks","splice","cleanup","ref","list","refs","temp","forEach","result","keys"],"sourceRoot":""}