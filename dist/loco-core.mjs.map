{"version":3,"file":"loco-core.mjs","mappings":"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","sources":["webpack://loco-js-core/./src/init.js","webpack://loco-js-core/./src/helpers.js","webpack://loco-js-core/./src/start/config.js","webpack://loco-js-core/./src/start/node.js","webpack://loco-js-core/./src/start/scan.js","webpack://loco-js-core/./src/start/validate.js","webpack://loco-js-core/./src/start/id.js","webpack://loco-js-core/./src/start/init.js","webpack://loco-js-core/./src/start/observe.js","webpack://loco-js-core/./src/start/observeScripts.js","webpack://loco-js-core/./src/start.js","webpack://loco-js-core/./src/start/helpers.js","webpack://loco-js-core/./src/component.js"],"sourcesContent":["let namespaceController = null;\nlet controller = null;\n\nconst callFunc = (resource, name) => {\n  if (typeof resource.constructor[name] === \"function\") {\n    resource.constructor[name]();\n  }\n  if (typeof resource[name] === \"function\") {\n    resource[name]();\n  }\n};\n\nconst getController = (Controllers, name, subName) => {\n  const resource =\n    subName === undefined ? Controllers[name] : Controllers[name][subName];\n  if (typeof resource === \"function\") {\n    return new resource();\n  } else if (typeof resource === \"object\") {\n    return resource;\n  }\n  return null;\n};\n\nconst init = (Controllers) => {\n  const body = document.getElementsByTagName(\"body\")[0];\n  const namespaceName = body.getAttribute(\"data-namespace\");\n  const controllerName = body.getAttribute(\"data-controller\");\n  const actionName = body.getAttribute(\"data-action\");\n\n  if (controller !== null) {\n    callFunc(controller, \"deinitialize\");\n    controller = null;\n  }\n  if (namespaceController !== null) {\n    callFunc(namespaceController, \"deinitialize\");\n    namespaceController = null;\n  }\n\n  namespaceController = getController(Controllers, namespaceName);\n  controller = getController(Controllers, controllerName);\n\n  if (namespaceController !== null) {\n    controller = getController(Controllers, namespaceName, controllerName);\n    namespaceController.controller = controller;\n    callFunc(namespaceController, \"initialize\");\n  }\n  if (controller !== null) {\n    controller.namespaceController = namespaceController;\n    callFunc(controller, \"initialize\");\n    callFunc(controller, actionName);\n  }\n\n  return { namespaceController, controller, action: actionName };\n};\n\nexport default init;\n","const fetchParams = (url = window.location.href) => {\n  const params = {};\n  const match = /https?:\\/\\/.+\\/\\w+\\/(\\d+)/.exec(url);\n  const id = match !== null ? match[1] : null;\n  if (id !== null) {\n    params[\"id\"] = parseInt(id);\n  }\n  const splitUrl = url.split(\"?\");\n  if (splitUrl.length === 1) return params;\n  const paramsString = splitUrl[splitUrl.length - 1];\n  const paramsArray = paramsString.split(\"&\").map((s) => s.split(\"=\"));\n  for (const arr of paramsArray) {\n    let key = decodeURIComponent(arr[0]);\n    let val = decodeURIComponent(arr[1]);\n    if (typeof val === \"string\") {\n      val = val.replace(/\\+/g, \" \");\n    }\n    params[key] = val;\n  }\n  return params;\n};\n\nexport default {\n  get params() {\n    return fetchParams();\n  },\n};\n","export const dataComponentAttribute = \"data-component\";\n","import { dataComponentAttribute } from \"./config.js\";\nexport const createNode = (element) => {\n  return {\n    name: element.getAttribute(dataComponentAttribute),\n    element,\n    parent: null,\n    children: [],\n    siblings: [],\n  };\n};\n","import { dataComponentAttribute } from \"./config.js\";\nimport { createNode } from \"./node.js\";\n\nconst scanComponentElements = (searchRoot) => {\n  const componentElements = Array.from(\n    searchRoot.querySelectorAll(`[${dataComponentAttribute}]`),\n  ).filter((el) => el.tagName !== \"SCRIPT\");\n  if (\n    searchRoot instanceof Element &&\n    searchRoot.hasAttribute(dataComponentAttribute) &&\n    !componentElements.includes(searchRoot)\n  ) {\n    componentElements.unshift(searchRoot);\n  }\n  return componentElements;\n};\n\nexport const buildElementTree = (searchRoot) => {\n  const componentElements = scanComponentElements(searchRoot);\n  const nodes = componentElements.map((element) => createNode(element));\n\n  const elementToNode = new Map();\n  for (const node of nodes) elementToNode.set(node.element, node);\n\n  for (const element of componentElements) {\n    const node = elementToNode.get(element);\n    const parentElement = element.parentElement?.closest(\n      `[${dataComponentAttribute}]`,\n    );\n    if (parentElement && elementToNode.has(parentElement)) {\n      const parentNode = elementToNode.get(parentElement);\n      node.parent = parentNode;\n      parentNode.children.push(node);\n    }\n  }\n\n  const groupByParent = new Map();\n  for (const node of nodes) {\n    const key = node.parent ?? null;\n    if (!groupByParent.has(key)) groupByParent.set(key, []);\n    groupByParent.get(key).push(node);\n  }\n\n  for (const group of groupByParent.values()) {\n    for (const node of group) {\n      node.siblings = group.filter((n) => n !== node);\n    }\n  }\n\n  return nodes;\n};\n","export const validate = (nodes, componentClasses) => {\n  if (nodes.length === 0) {\n    throw new Error(\"No component elements found in the root element\");\n  }\n  for (const C of componentClasses) {\n    const ctorName =\n      C.prototype?.constructor?.name || C.constructor?.name || \"(anonymous)\";\n    const desc = Object.getOwnPropertyDescriptor(C, \"name\");\n    if (\n      typeof C.name !== \"string\" ||\n      C.name.length === 0 ||\n      !desc ||\n      desc.writable !== true\n    ) {\n      throw new Error(\n        `Invalid component class: missing static name (${ctorName})`,\n      );\n    }\n  }\n  const domNames = new Set(nodes.map((n) => n.name));\n  const providedNames = new Set(componentClasses.map((C) => C.name));\n  for (const name of domNames) {\n    if (!providedNames.has(name)) {\n      throw new Error(\n        `Found data-component=\"${name}\" but no matching class passed to start({ components })`,\n      );\n    }\n  }\n};\n","let componentIdCounter = 1;\nexport const generateComponentId = () => `${componentIdCounter++}`;\n","import { generateComponentId } from \"./id.js\";\n\nexport const initComponent = (node, ComponentClass) => {\n  const instance = new ComponentClass();\n  instance.node = node;\n  instance.componentId = generateComponentId();\n  return instance;\n};\n\nexport const extendElement = (element, instance) => {\n  element.setAttribute(\"data-component-id\", instance.componentId);\n  element.instance = instance;\n};\n\nexport const initMatches = (nodes, componentClasses) => {\n  const instances = [];\n  for (const ComponentClass of componentClasses) {\n    for (const node of nodes) {\n      if (node.name != ComponentClass.name) continue;\n\n      const instance = initComponent(node, ComponentClass);\n      extendElement(node.element, instance);\n      instances.push(instance);\n    }\n  }\n  for (const instance of instances) {\n    if (typeof instance.connect === \"function\") instance.connect();\n  }\n  return instances;\n};\n","import { dataComponentAttribute } from \"./config.js\";\nimport { initComponent, extendElement } from \"./init.js\";\nimport { createNode } from \"./node.js\";\n\nconst isScriptElement = (el) => el.tagName === \"SCRIPT\";\n\nconst validNode = (node) =>\n  !isScriptElement(node) && node.hasAttribute(dataComponentAttribute);\n\nconst instancesForElements = (elements, classByName) => {\n  const instances = [];\n  for (const el of elements) {\n    const name = el.getAttribute(dataComponentAttribute);\n    const ComponentClass = classByName.get(name);\n    if (!ComponentClass) continue;\n\n    const node = createNode(el);\n    const instance = initComponent(node, ComponentClass);\n    extendElement(el, instance);\n    instances.push(instance);\n  }\n  return instances;\n};\n\nconst filterElements = (elements, classByName) => {\n  return Array.from(elements).filter((el) => {\n    if (isScriptElement(el)) return false;\n    const name = el.getAttribute(dataComponentAttribute);\n    return classByName.has(name) && !el.instance;\n  });\n};\n\nconst addedElements = (mutations) => {\n  const added = new Set();\n  for (const m of mutations) {\n    for (const node of m.addedNodes) {\n      if (!(node instanceof Element)) continue;\n\n      if (validNode(node)) added.add(node);\n      node.querySelectorAll(`[${dataComponentAttribute}]`).forEach((el) => {\n        if (!isScriptElement(el)) added.add(el);\n      });\n    }\n  }\n  return added;\n};\n\nconst removedElements = (mutations) => {\n  const removed = new Set();\n  for (const m of mutations) {\n    for (const node of m.removedNodes) {\n      if (!(node instanceof Element)) continue;\n\n      if (validNode(node)) removed.add(node);\n      node.querySelectorAll(`[${dataComponentAttribute}]`).forEach((el) => {\n        if (!isScriptElement(el)) removed.add(el);\n      });\n    }\n  }\n  return removed;\n};\n\nconst existingElements = (searchRoot) => {\n  const elements = new Set();\n  if (searchRoot instanceof Element) {\n    if (validNode(searchRoot)) elements.add(searchRoot);\n  }\n  if (typeof searchRoot.querySelectorAll === \"function\") {\n    searchRoot.querySelectorAll(`[${dataComponentAttribute}]`).forEach((el) => {\n      if (!isScriptElement(el)) elements.add(el);\n    });\n  }\n  return elements;\n};\n\nconst linkInstances = (instances) => {\n  for (const instance of instances) {\n    // Link to parent instances (if any) and update children relationships.\n    const parentEl = instance.element.parentElement?.closest(\n      `[${dataComponentAttribute}]`,\n    );\n    if (parentEl) {\n      const parentInstance = parentEl.instance;\n      if (parentInstance) {\n        instance.addParent(parentInstance);\n      }\n    }\n    for (const childInstance of instances) {\n      if (childInstance.element === instance.element) continue;\n\n      const nearest = childInstance.element.parentElement?.closest(\n        `[${dataComponentAttribute}]`,\n      );\n      if (nearest === instance.element) {\n        instance.node.children.push(childInstance.node);\n        childInstance.node.parent = instance.node;\n      }\n    }\n  }\n\n  // After parent/child links are established, update siblings for all\n  // parents that gained new children in this batch.\n  const parentsToUpdate = new Set();\n  for (const instance of instances) {\n    if (instance.node.parent) {\n      parentsToUpdate.add(instance.node.parent);\n    }\n  }\n  for (const parentNode of parentsToUpdate) {\n    const children = parentNode.children;\n    for (const childNode of children) {\n      childNode.siblings = children.filter((n) => n !== childNode);\n    }\n  }\n\n  for (const instance of instances) {\n    if (typeof instance.connect === \"function\") instance.connect();\n  }\n};\n\nexport const observe = (searchRoot, componentClasses = []) => {\n  const classByName = new Map();\n\n  const addComponents = (newComponentClasses = []) => {\n    for (const ComponentClass of newComponentClasses) {\n      classByName.set(ComponentClass.name, ComponentClass);\n    }\n    const existing = existingElements(searchRoot);\n    const filtered = filterElements(existing, classByName);\n    if (filtered.length === 0) return [];\n\n    const instances = instancesForElements(filtered, classByName);\n    linkInstances(instances);\n    return instances;\n  };\n\n  const observer = new MutationObserver((mutations) => {\n    const removed = removedElements(mutations);\n    if (removed.size > 0) {\n      for (const el of removed) el.instance?.disconnect();\n    }\n\n    const added = addedElements(mutations);\n    if (added.size === 0) return;\n\n    const filtered = filterElements(added, classByName);\n    if (filtered.length === 0) return;\n\n    const instances = instancesForElements(filtered, classByName);\n    linkInstances(instances);\n  });\n\n  observer.observe(searchRoot, { childList: true, subtree: true });\n\n  if (componentClasses.length > 0) {\n    addComponents(componentClasses);\n  }\n\n  return {\n    addComponents,\n  };\n};\n","const processedAttr = \"data-script-processed\";\n\nconst isJsonTemplateScript = (node) =>\n  node instanceof HTMLScriptElement &&\n  node.type === \"application/json\" &&\n  node.hasAttribute(\"data-component\");\n\nconst collectScripts = (node) => {\n  const scripts = [];\n  if (isJsonTemplateScript(node)) scripts.push(node);\n  if (node?.querySelectorAll) {\n    node\n      .querySelectorAll(\"script[type='application/json'][data-component]\")\n      .forEach((s) => scripts.push(s));\n  }\n  return scripts;\n};\n\n// TODO: component without template\nconst processScript = (script, componentClasses) => {\n  if (script.hasAttribute(processedAttr)) return;\n\n  const componentName = script.dataset.component;\n  const componentClass = componentClasses.find((c) => c.name === componentName);\n  if (!componentClass) return;\n\n  const targetId = script.dataset.target;\n  const targetEl = document.getElementById(targetId);\n  if (!targetEl) {\n    throw new Error(`Script data-target=\"${targetId}\" element not found`);\n  }\n\n  const position = script.dataset.position ?? \"beforeend\";\n  const arr = JSON.parse(script.textContent);\n  let html = \"\";\n  arr.forEach((templateData) => {\n    html += componentClass.template(templateData);\n  });\n  targetEl.insertAdjacentHTML(position, html);\n  script.setAttribute(processedAttr, \"true\");\n};\n\nconst processScripts = (node, componentClasses) => {\n  collectScripts(node).forEach((script) =>\n    processScript(script, componentClasses),\n  );\n};\n\nexport const observeScripts = (searchRoot, componentClasses) => {\n  processScripts(searchRoot, componentClasses);\n\n  const observer = new MutationObserver((mutations) => {\n    for (const m of mutations) {\n      for (const node of m.addedNodes) {\n        if (!(node instanceof Element)) continue;\n        processScripts(node, componentClasses);\n      }\n    }\n  });\n\n  observer.observe(searchRoot, { childList: true, subtree: true });\n\n  return {\n    addComponents(newComponentClasses = []) {\n      componentClasses.push(...newComponentClasses);\n      processScripts(searchRoot, componentClasses);\n    },\n    disconnect() {\n      observer.disconnect();\n    },\n  };\n};\n","import { buildElementTree } from \"./start/scan.js\";\nimport { validate } from \"./start/validate.js\";\nimport { initMatches } from \"./start/init.js\";\nimport { observe } from \"./start/observe.js\";\nimport { observeScripts } from \"./start/observeScripts.js\";\n\nconst start = (options = {}) => {\n  const searchRoot = options.root ?? document.body;\n  const componentClasses = [...(options.components ?? [])];\n\n  const nodes = buildElementTree(searchRoot);\n  validate(nodes, componentClasses);\n\n  const instances = initMatches(nodes, componentClasses);\n  const observer = observe(searchRoot, componentClasses);\n  const scriptObserver = observeScripts(searchRoot, componentClasses);\n  const roots = instances.filter((i) => i.node.parent === null);\n\n  return {\n    roots: roots,\n    components: componentClasses,\n    addComponents(newComponents) {\n      const filteredNewComponents = newComponents.filter(\n        (ComponentClass) =>\n          typeof ComponentClass === \"function\" &&\n          !componentClasses.includes(ComponentClass),\n      );\n      if (filteredNewComponents.length === 0) return null;\n\n      componentClasses.push(...filteredNewComponents);\n      const updatedNodes = buildElementTree(searchRoot);\n      validate(updatedNodes, componentClasses);\n\n      const newInstances = observer.addComponents(filteredNewComponents);\n      scriptObserver.addComponents(filteredNewComponents);\n      return newInstances;\n    },\n  };\n};\n\nexport default start;\n","export const destructArray = (array) => {\n  switch (array.length) {\n    case 0:\n      return null;\n    case 1:\n      return array[0];\n    default:\n      return array;\n  }\n};\n","import { destructArray } from \"./start/helpers.js\";\n\nexport default class Component {\n  constructor() {\n    this._cleanupCallbacks = [];\n    this._isDisconnected = false;\n  }\n\n  get element() {\n    return this.node.element;\n  }\n\n  get parent() {\n    return this.node.parent?.element.instance;\n  }\n\n  addParent(parent) {\n    this.node.parent = parent.node;\n    parent.node.children.push(this.node);\n  }\n\n  registerCleanup(callback) {\n    if (typeof callback === \"function\") this._cleanupCallbacks.push(callback);\n    return callback;\n  }\n\n  on(target, type, listener, options) {\n    target.addEventListener(type, listener, options);\n    const off = () => target.removeEventListener(type, listener, options);\n    this.registerCleanup(off);\n    return off;\n  }\n\n  timeout(callback, delay) {\n    const id = setTimeout(callback, delay);\n    this.registerCleanup(() => clearTimeout(id));\n    return id;\n  }\n\n  interval(callback, delay) {\n    const id = setInterval(callback, delay);\n    this.registerCleanup(() => clearInterval(id));\n    return id;\n  }\n\n  disconnect() {\n    if (this._isDisconnected) return;\n    this._isDisconnected = true;\n    const callbacks = this._cleanupCallbacks.splice(0);\n    for (const cleanup of callbacks) cleanup();\n    this.#detachFromParent();\n  }\n\n  ref(name) {\n    const list = Array.from(\n      this.element.querySelectorAll(`[data-ref=\"${name}\"]`),\n    );\n    return destructArray(list);\n  }\n\n  refs() {\n    const temp = {};\n    const elements = this.element.querySelectorAll(\"[data-ref]\");\n    elements.forEach((el) => {\n      const key = el.getAttribute(\"data-ref\");\n      if (!temp[key]) temp[key] = [];\n      temp[key].push(el);\n    });\n    const result = {};\n    Object.keys(temp).forEach((key) => {\n      result[key] = destructArray(temp[key]);\n    });\n    return result;\n  }\n\n  children(name) {\n    return this.#related(\"children\", name);\n  }\n\n  siblings(name) {\n    return this.#related(\"siblings\", name);\n  }\n\n  #related(type, name) {\n    const names = Array.isArray(name) ? name : [name];\n    const nameSet = new Set(names);\n    return this.node[type]\n      .filter((n) => nameSet.has(n.name))\n      .map((n) => n.element.instance);\n  }\n\n  #detachFromParent() {\n    const parentNode = this.node.parent;\n    if (!parentNode) return;\n    const index = parentNode.children.indexOf(this.node);\n    if (index !== -1) parentNode.children.splice(index, 1);\n    this.node.parent = null;\n  }\n}\n"],"names":["namespaceController","controller","callFunc","resource","name","constructor","getController","Controllers","subName","undefined","body","document","getElementsByTagName","namespaceName","getAttribute","controllerName","actionName","action","params","url","window","location","href","match","exec","id","parseInt","splitUrl","split","length","paramsArray","map","s","arr","key","decodeURIComponent","val","replace","fetchParams","dataComponentAttribute","createNode","element","parent","children","siblings","buildElementTree","searchRoot","componentElements","Array","from","querySelectorAll","filter","el","tagName","Element","hasAttribute","includes","unshift","scanComponentElements","nodes","elementToNode","Map","node","set","get","parentElement","closest","has","parentNode","push","groupByParent","group","values","n","validate","componentClasses","Error","C","ctorName","prototype","desc","Object","getOwnPropertyDescriptor","writable","domNames","Set","providedNames","componentIdCounter","initComponent","ComponentClass","instance","componentId","extendElement","setAttribute","isScriptElement","validNode","instancesForElements","elements","classByName","instances","filterElements","linkInstances","parentEl","parentInstance","addParent","childInstance","nearest","parentsToUpdate","add","childNode","connect","processedAttr","processScripts","scripts","HTMLScriptElement","type","isJsonTemplateScript","forEach","collectScripts","script","componentName","dataset","component","componentClass","find","c","targetId","target","targetEl","getElementById","position","JSON","parse","textContent","html","templateData","template","insertAdjacentHTML","processScript","options","root","components","initMatches","observer","addComponents","newComponentClasses","existing","existingElements","filtered","MutationObserver","mutations","removed","m","removedNodes","removedElements","size","disconnect","added","addedNodes","addedElements","observe","childList","subtree","scriptObserver","observeScripts","roots","i","newComponents","filteredNewComponents","updatedNodes","newInstances","destructArray","array","Component","this","_cleanupCallbacks","_isDisconnected","registerCleanup","callback","on","listener","addEventListener","off","removeEventListener","timeout","delay","setTimeout","clearTimeout","interval","setInterval","clearInterval","callbacks","splice","cleanup","ref","list","refs","temp","result","keys","names","isArray","nameSet","index","indexOf"],"sourceRoot":""}