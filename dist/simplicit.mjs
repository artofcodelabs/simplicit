let t=null,e=null;const n=(t,e)=>{"function"==typeof t.constructor[e]&&t.constructor[e](),"function"==typeof t[e]&&t[e]()},o=(t,e,n)=>{const o=void 0===n?t[e]:t[e][n];return"function"==typeof o?new o:"object"==typeof o?o:null};var r=r=>{const s=document.getElementsByTagName("body")[0],c=s.getAttribute("data-namespace"),a=s.getAttribute("data-controller"),i=s.getAttribute("data-action");return null!==e&&(n(e,"deinitialize"),e=null),null!==t&&(n(t,"deinitialize"),t=null),t=o(r,c),e=o(r,a),null!==t&&(e=o(r,c,a),t.controller=e,n(t,"initialize")),null!==e&&(e.namespaceController=t,n(e,"initialize"),n(e,i)),{namespaceController:t,controller:e,action:i}},s={get params(){return((t=window.location.href)=>{const e={},n=/https?:\/\/.+\/\w+\/(\d+)/.exec(t),o=null!==n?n[1]:null;null!==o&&(e.id=parseInt(o));const r=t.split("?");if(1===r.length)return e;const s=r[r.length-1].split("&").map(t=>t.split("="));for(const t of s){let n=decodeURIComponent(t[0]),o=decodeURIComponent(t[1]);"string"==typeof o&&(o=o.replace(/\+/g," ")),e[n]=o}return e})()}};const c="data-component",a=t=>({name:t.getAttribute(c),element:t,parent:null,children:[],siblings:[]}),i=t=>{const e=(t=>{const e=Array.from(t.querySelectorAll(`[${c}]`)).filter(t=>"SCRIPT"!==t.tagName);return t instanceof Element&&t.hasAttribute(c)&&!e.includes(t)&&e.unshift(t),e})(t),n=e.map(t=>a(t)),o=new Map;for(const t of n)o.set(t.element,t);for(const t of e){const e=o.get(t),n=t.parentElement?.closest(`[${c}]`);if(n&&o.has(n)){const t=o.get(n);e.parent=t,t.children.push(e)}}const r=new Map;for(const t of n){const e=t.parent??null;r.has(e)||r.set(e,[]),r.get(e).push(t)}for(const t of r.values())for(const e of t)e.siblings=t.filter(t=>t!==e);return n},l=(t,e)=>{if(0===t.length)throw new Error("No component elements found in the root element");for(const t of e){const e=t.prototype?.constructor?.name||t.constructor?.name||"(anonymous)",n=Object.getOwnPropertyDescriptor(t,"name");if("string"!=typeof t.name||0===t.name.length||!n||!0!==n.writable)throw new Error(`Invalid component class: missing static name (${e})`)}const n=new Set(t.map(t=>t.name)),o=new Set(e.map(t=>t.name));for(const t of n)if(!o.has(t))throw new Error(`Found data-component="${t}" but no matching class passed to start({ components })`)};let u=1;const d=(t,e)=>{const n=new e;return n.node=t,n.componentId=""+u++,n},f=(t,e)=>{t.setAttribute("data-component-id",e.componentId),t.instance=e},p=t=>"SCRIPT"===t.tagName,m=t=>!p(t)&&t.hasAttribute(c),h=(t,e)=>{const n=[];for(const o of t){const t=o.getAttribute(c),r=e.get(t);if(!r)continue;const s=a(o),i=d(s,r);f(o,i),n.push(i)}return n},g=(t,e)=>Array.from(t).filter(t=>{if(p(t))return!1;const n=t.getAttribute(c);return e.has(n)&&!t.instance}),b=t=>{for(const e of t){const n=e.element.parentElement?.closest(`[${c}]`);if(n){const t=n.instance;t&&e.addParent(t)}for(const n of t){if(n.element===e.element)continue;const t=n.element.parentElement?.closest(`[${c}]`);t===e.element&&(e.node.children.push(n.node),n.node.parent=e.node)}}const e=new Set;for(const n of t)n.node.parent&&e.add(n.node.parent);for(const t of e){const e=t.children;for(const t of e)t.siblings=e.filter(e=>e!==t)}for(const e of t)"function"==typeof e.connect&&e.connect()},y="data-script-processed",w=(t,e)=>{(t=>{const e=[];return(t=>t instanceof HTMLScriptElement&&"application/json"===t.type&&t.hasAttribute("data-component"))(t)&&e.push(t),t?.querySelectorAll&&t.querySelectorAll("script[type='application/json'][data-component]").forEach(t=>e.push(t)),e})(t).forEach(t=>((t,e)=>{if(t.hasAttribute(y))return;const n=t.dataset.component,o=e.find(t=>t.name===n);if(!o)return;const r=t.dataset.target,s=document.getElementById(r);if(!s)throw new Error(`Script data-target="${r}" element not found`);const c=t.dataset.position??"beforeend",a=JSON.parse(t.textContent);let i="";a.forEach(t=>{i+=o.template(t)}),s.insertAdjacentHTML(c,i),t.setAttribute(y,"true")})(t,e))};var A=(t={})=>{const e=t.root??document.body,n=[...t.components??[]],o=i(e);l(o,n);const r=((t,e)=>{const n=[];for(const o of e)for(const e of t){if(e.name!=o.name)continue;const t=d(e,o);f(e.element,t),n.push(t)}for(const t of n)"function"==typeof t.connect&&t.connect();return n})(o,n),s=((t,e=[])=>{const n=new Map,o=(e=[])=>{for(const t of e)n.set(t.name,t);const o=(t=>{const e=new Set;return t instanceof Element&&m(t)&&e.add(t),"function"==typeof t.querySelectorAll&&t.querySelectorAll(`[${c}]`).forEach(t=>{p(t)||e.add(t)}),e})(t),r=g(o,n);if(0===r.length)return[];const s=h(r,n);return b(s),s};return new MutationObserver(t=>{const e=(t=>{const e=new Set;for(const n of t)for(const t of n.removedNodes)t instanceof Element&&(m(t)&&e.add(t),t.querySelectorAll(`[${c}]`).forEach(t=>{p(t)||e.add(t)}));return e})(t);if(e.size>0)for(const t of e)t.instance?.disconnect();const o=(t=>{const e=new Set;for(const n of t)for(const t of n.addedNodes)t instanceof Element&&(m(t)&&e.add(t),t.querySelectorAll(`[${c}]`).forEach(t=>{p(t)||e.add(t)}));return e})(t);if(0===o.size)return;const r=g(o,n);if(0===r.length)return;const s=h(r,n);b(s)}).observe(t,{childList:!0,subtree:!0}),e.length>0&&o(e),{addComponents:o}})(e,n),a=((t,e)=>{w(t,e);const n=new MutationObserver(t=>{for(const n of t)for(const t of n.addedNodes)t instanceof Element&&w(t,e)});return n.observe(t,{childList:!0,subtree:!0}),{addComponents(n=[]){e.push(...n),w(t,e)},disconnect(){n.disconnect()}}})(e,n);return{roots:r.filter(t=>null===t.node.parent),components:n,addComponents(t){const o=t.filter(t=>"function"==typeof t&&!n.includes(t));if(0===o.length)return null;n.push(...o);const r=i(e);l(r,n);const c=s.addComponents(o);return a.addComponents(o),c}}};const E=t=>{switch(t.length){case 0:return null;case 1:return t[0];default:return t}};class S{constructor(){this._cleanupCallbacks=[],this._isDisconnected=!1}get element(){return this.node.element}get parent(){return this.node.parent?.element.instance}addParent(t){this.node.parent=t.node,t.node.children.push(this.node)}registerCleanup(t){return"function"==typeof t&&this._cleanupCallbacks.push(t),t}on(t,e,n,o){t.addEventListener(e,n,o);const r=()=>t.removeEventListener(e,n,o);return this.registerCleanup(r),r}timeout(t,e){const n=setTimeout(t,e);return this.registerCleanup(()=>clearTimeout(n)),n}interval(t,e){const n=setInterval(t,e);return this.registerCleanup(()=>clearInterval(n)),n}disconnect(){if(this._isDisconnected)return;this._isDisconnected=!0;const t=this._cleanupCallbacks.splice(0);for(const e of t)e();this.#t()}ref(t){const e=Array.from(this.element.querySelectorAll(`[data-ref="${t}"]`));return E(e)}refs(){const t={};this.element.querySelectorAll("[data-ref]").forEach(e=>{const n=e.getAttribute("data-ref");t[n]||(t[n]=[]),t[n].push(e)});const e={};return Object.keys(t).forEach(n=>{e[n]=E(t[n])}),e}children(t){return this.#e("children",t)}siblings(t){return this.#e("siblings",t)}ancestor(t){let e=this.node.parent;for(;e;){if(e.name===t)return e.element.instance;e=e.parent}return null}descendants(t){const e=[],n=new Set,o=r=>{for(const s of r.children)n.has(s)||(n.add(s),s.name===t&&e.push(s.element.instance),o(s))};return o(this.node),e}#e(t,e){const n=Array.isArray(e)?e:[e],o=new Set(n);return this.node[t].filter(t=>o.has(t.name)).map(t=>t.element.instance)}#t(){const t=this.node.parent;if(!t)return;const e=t.children.indexOf(this.node);-1!==e&&t.children.splice(e,1),this.node.parent=null}}export{S as Component,s as helpers,r as init,A as start};
//# sourceMappingURL=simplicit.mjs.map