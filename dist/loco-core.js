!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("LocoCore",[],t):"object"==typeof exports?exports.LocoCore=t():e.LocoCore=t()}(window,function(){return function(){"use strict";var e={d:function(t,n){for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Component:function(){return d},helpers:function(){return a},init:function(){return s},start:function(){return f}});let n=null,o=null;const r=(e,t)=>{"function"==typeof e.constructor[t]&&e.constructor[t](),"function"==typeof e[t]&&e[t]()},c=(e,t,n)=>{const o=void 0===n?e[t]:e[t][n];return"function"==typeof o?new o:"object"==typeof o?o:null};var s=e=>{const t=document.getElementsByTagName("body")[0],s=t.getAttribute("data-namespace"),a=t.getAttribute("data-controller"),l=t.getAttribute("data-action");return null!==o&&(r(o,"deinitialize"),o=null),null!==n&&(r(n,"deinitialize"),n=null),n=c(e,s),o=c(e,a),null!==n&&(o=c(e,s,a),n.controller=o,r(n,"initialize")),null!==o&&(o.namespaceController=n,r(o,"initialize"),r(o,l)),{namespaceController:n,controller:o,action:l}},a={get params(){return((e=window.location.href)=>{const t={},n=/https?:\/\/.+\/\w+\/(\d+)/.exec(e),o=null!==n?n[1]:null;null!==o&&(t.id=parseInt(o));const r=e.split("?");if(1===r.length)return t;const c=r[r.length-1].split("&").map(e=>e.split("="));for(const e of c){let n=decodeURIComponent(e[0]),o=decodeURIComponent(e[1]);"string"==typeof o&&(o=o.replace(/\+/g," ")),t[n]=o}return t})()}};let l=1;const i=()=>""+l++,u=new WeakMap;var f=(e={})=>{const t=e.root??document,n=Array.isArray(e.components)?e.components:[],o=[],r=(e=>e&&e.body?e.body:e)(t),c=(e=>{const t=Array.from(e.querySelectorAll("[data-component]"));return e instanceof Element&&e.hasAttribute("data-component")&&!t.includes(e)&&t.unshift(e),t})(r),{elementToNode:s}=(e=>{const t=[],n=new Map;for(const t of e){const e=t.getAttribute("data-component");n.set(t,{name:e,element:t,parent:null,children:[]})}for(const o of e){const e=n.get(o),r=o.parentElement?.closest("[data-component]");if(r&&n.has(r)){const t=n.get(r);e.parent=t,t.children.push(e)}else t.push(e)}return{components:t,elementToNode:n}})(c);return o.push(...Array.from(s.values()).filter(e=>null===e.parent)),((e,t)=>{for(const n of t){const t="string"==typeof n?.name?n.name:null;if(!t)continue;const o=[];for(const n of e.values())n.name===t&&o.push(n);for(const e of o){const t=new n;t.element=e.element;const o={...e};delete o.name,delete o.element,t.node=o,t.componentId=i(),e.element.setAttribute("data-component-id",t.componentId),e.element.instance=t,"function"==typeof t.connect&&t.connect()}}})(s,n),((e,t)=>{if(!e||0===e.length)return;const n=new Set(Array.from(e,e=>e.getAttribute("data-component"))),o=new Set((Array.isArray(t)?t:[]).map(e=>"string"==typeof e?.name?e.name:null).filter(Boolean));for(const e of n)o.has(e)||console.warn(`Found data-component="${e}" but no matching class passed to start({ components })`)})(c,n),((e,t)=>{const n=new Map;u.has(e)&&u.get(e).classByName.forEach((e,t)=>n.set(t,e));for(const e of t){const t="string"==typeof e?.name?e.name:null;t&&n.set(t,e)}if(u.has(e))return void(u.get(e).classByName=n);const o=new MutationObserver(e=>{const t=new Set;for(const n of e)for(const e of n.addedNodes)e instanceof Element&&(e.hasAttribute("data-component")&&t.add(e),e.querySelectorAll?.("[data-component]").forEach(e=>t.add(e)));if(0===t.size)return;const o=Array.from(t).filter(e=>{const t=e.getAttribute("data-component");return n.has(t)&&!e.instance});if(0===o.length)return;const r=new Map;for(const e of o){const t=e.getAttribute("data-component"),o=n.get(t);if(!o)continue;const c=new o;c.element=e,c.node={parent:null,children:[]},c.componentId=i(),e.setAttribute("data-component-id",c.componentId),e.instance=c,r.set(e,c)}for(const e of o){const t=r.get(e);if(!t)continue;const n=e.parentElement?.closest("[data-component]");if(n){const e=r.get(n)||n.instance;e&&e.node&&(t.node.parent=e.node,e.node.children.push(t.node))}for(const n of o){if(n===e)continue;const o=n.parentElement?.closest("[data-component]");if(o===e){const e=r.get(n);e&&(t.node.children.push(e.node),e.node.parent=t.node)}}}for(const e of r.values())"function"==typeof e.connect&&e.connect()});o.observe(e,{childList:!0,subtree:!0}),u.set(e,{observer:o,classByName:n})})(r,n),o};class d{constructor(){this._cleanupCallbacks=[],this._isDisconnected=!1}registerCleanup(e){return"function"==typeof e&&this._cleanupCallbacks.push(e),e}on(e,t,n,o){e.addEventListener(t,n,o);const r=()=>e.removeEventListener(t,n,o);return this.registerCleanup(r),r}timeout(e,t){const n=setTimeout(e,t);return this.registerCleanup(()=>clearTimeout(n)),n}interval(e,t){const n=setInterval(e,t);return this.registerCleanup(()=>clearInterval(n)),n}disconnect(){if(this._isDisconnected)return;this._isDisconnected=!0;const e=this._cleanupCallbacks.splice(0);for(const t of e)t()}ref(e){const t=Array.from(this.element.querySelectorAll(`[data-ref="${e}"]`));return 0===t.length?[]:1===t.length?t[0]:t}refs(){const e={};this.element.querySelectorAll("[data-ref]").forEach(t=>{const n=t.getAttribute("data-ref");e[n]||(e[n]=[]),e[n].push(t)});const t={};return Object.keys(e).forEach(n=>{const o=e[n];t[n]=1===o.length?o[0]:o}),t}}return t}()});
//# sourceMappingURL=loco-core.js.map