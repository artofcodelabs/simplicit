!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("LocoCore",[],t):"object"==typeof exports?exports.LocoCore=t():e.LocoCore=t()}(window,function(){return function(){"use strict";var e={d:function(t,n){for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Component:function(){return d},helpers:function(){return i},init:function(){return s},start:function(){return p}});let n=null,o=null;const r=(e,t)=>{"function"==typeof e.constructor[t]&&e.constructor[t](),"function"==typeof e[t]&&e[t]()},c=(e,t,n)=>{const o=void 0===n?e[t]:e[t][n];return"function"==typeof o?new o:"object"==typeof o?o:null};var s=e=>{const t=document.getElementsByTagName("body")[0],s=t.getAttribute("data-namespace"),i=t.getAttribute("data-controller"),l=t.getAttribute("data-action");return null!==o&&(r(o,"deinitialize"),o=null),null!==n&&(r(n,"deinitialize"),n=null),n=c(e,s),o=c(e,i),null!==n&&(o=c(e,s,i),n.controller=o,r(n,"initialize")),null!==o&&(o.namespaceController=n,r(o,"initialize"),r(o,l)),{namespaceController:n,controller:o,action:l}},i={get params(){return((e=window.location.href)=>{const t={},n=/https?:\/\/.+\/\w+\/(\d+)/.exec(e),o=null!==n?n[1]:null;null!==o&&(t.id=parseInt(o));const r=e.split("?");if(1===r.length)return t;const c=r[r.length-1].split("&").map(e=>e.split("="));for(const e of c){let n=decodeURIComponent(e[0]),o=decodeURIComponent(e[1]);"string"==typeof o&&(o=o.replace(/\+/g," ")),t[n]=o}return t})()}};const l="data-component";let a=1;const u=(e,t)=>{const n=new t;n.element=e.element;const{parent:o,children:r}={...e};return n.node={parent:o,children:r},n.componentId=""+a++,n},f=(e,t)=>{e.setAttribute("data-component-id",t.componentId),e.instance=t};var p=(e={})=>{const t=e.root??document.body,n=Array.isArray(e.components)?e.components:[],o=(e=>{const t=(e=>{const t=Array.from(e.querySelectorAll(`[${l}]`));return e instanceof Element&&e.hasAttribute(l)&&!t.includes(e)&&t.unshift(e),t})(e),n=t.map(e=>({name:e.getAttribute(l),element:e,parent:null,children:[]})),o=new Map;for(const e of n)o.set(e.element,e);for(const e of t){const t=o.get(e),n=e.parentElement?.closest(`[${l}]`);if(n&&o.has(n)){const e=o.get(n);t.parent=e,e.children.push(t)}}return n})(t);return((e,t)=>{if(0===e.length)throw new Error("No component elements found in the root element");for(const e of t){const t=e.prototype?.constructor?.name||e.constructor?.name||"(anonymous)",n=Object.getOwnPropertyDescriptor(e,"name");if("string"!=typeof e.name||0===e.name.length||!n||!0!==n.writable)throw new Error(`Invalid component class: missing static name (${t})`)}const n=new Set(e.map(e=>e.name)),o=new Set(t.map(e=>e.name));for(const e of n)if(!o.has(e))throw new Error(`Found data-component="${e}" but no matching class passed to start({ components })`)})(o,n),((e,t)=>{const n=[];for(const o of t)for(const t of e){if(t.name!=o.name)continue;const e=u(t,o);f(t.element,e),n.push(e)}for(const e of n)"function"==typeof e.connect&&e.connect()})(o,n),((e,t)=>{const n=new Map;for(const e of t)n.set(e.name,e);new MutationObserver(e=>{const t=(e=>{const t=new Set;for(const n of e)for(const e of n.addedNodes)e instanceof Element&&(e.hasAttribute(l)&&t.add(e),e.querySelectorAll?.(`[${l}]`).forEach(e=>t.add(e)));return t})(e);if(0===t.size)return;const o=((e,t)=>Array.from(e).filter(e=>{const n=e.getAttribute(l);return t.has(n)&&!e.instance}))(t,n);if(0===o.length)return;const r=((e,t)=>{const n=new Array;for(const o of e){const e=o.getAttribute(l),r=t.get(e);if(!r)continue;const c=u({element:o,parent:null,children:[]},r);f(o,c),n.push(c)}return n})(o,n);for(const e of r){const t=e.element.parentElement?.closest(`[${l}]`);if(t){const n=t.instance;n&&e.addParent(n)}for(const t of r){if(t.element===e.element)continue;const n=t.element.parentElement?.closest(`[${l}]`);n===e.element&&(e.node.children.push(t.node),t.node.parent=e.node)}}for(const e of r)"function"==typeof e.connect&&e.connect()}).observe(e,{childList:!0,subtree:!0})})(t,n),o.filter(e=>null===e.parent)};class d{constructor(){this._cleanupCallbacks=[],this._isDisconnected=!1}addParent(e){this.node.parent=e.node,e.node.children.push(this.node)}registerCleanup(e){return"function"==typeof e&&this._cleanupCallbacks.push(e),e}on(e,t,n,o){e.addEventListener(t,n,o);const r=()=>e.removeEventListener(t,n,o);return this.registerCleanup(r),r}timeout(e,t){const n=setTimeout(e,t);return this.registerCleanup(()=>clearTimeout(n)),n}interval(e,t){const n=setInterval(e,t);return this.registerCleanup(()=>clearInterval(n)),n}disconnect(){if(this._isDisconnected)return;this._isDisconnected=!0;const e=this._cleanupCallbacks.splice(0);for(const t of e)t()}ref(e){const t=Array.from(this.element.querySelectorAll(`[data-ref="${e}"]`));return 0===t.length?[]:1===t.length?t[0]:t}refs(){const e={};this.element.querySelectorAll("[data-ref]").forEach(t=>{const n=t.getAttribute("data-ref");e[n]||(e[n]=[]),e[n].push(t)});const t={};return Object.keys(e).forEach(n=>{const o=e[n];t[n]=1===o.length?o[0]:o}),t}parent(){return this.node.parent?.element.instance}children(){return this.node.children.map(e=>e.element.instance)}}return t}()});
//# sourceMappingURL=loco-core.js.map