!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("LocoCore",[],t):"object"==typeof exports?exports.LocoCore=t():e.LocoCore=t()}(window,function(){return function(){"use strict";var e={d:function(t,n){for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Component:function(){return h},helpers:function(){return i},init:function(){return c},start:function(){return m}});let n=null,o=null;const r=(e,t)=>{"function"==typeof e.constructor[t]&&e.constructor[t](),"function"==typeof e[t]&&e[t]()},s=(e,t,n)=>{const o=void 0===n?e[t]:e[t][n];return"function"==typeof o?new o:"object"==typeof o?o:null};var c=e=>{const t=document.getElementsByTagName("body")[0],c=t.getAttribute("data-namespace"),i=t.getAttribute("data-controller"),l=t.getAttribute("data-action");return null!==o&&(r(o,"deinitialize"),o=null),null!==n&&(r(n,"deinitialize"),n=null),n=s(e,c),o=s(e,i),null!==n&&(o=s(e,c,i),n.controller=o,r(n,"initialize")),null!==o&&(o.namespaceController=n,r(o,"initialize"),r(o,l)),{namespaceController:n,controller:o,action:l}},i={get params(){return((e=window.location.href)=>{const t={},n=/https?:\/\/.+\/\w+\/(\d+)/.exec(e),o=null!==n?n[1]:null;null!==o&&(t.id=parseInt(o));const r=e.split("?");if(1===r.length)return t;const s=r[r.length-1].split("&").map(e=>e.split("="));for(const e of s){let n=decodeURIComponent(e[0]),o=decodeURIComponent(e[1]);"string"==typeof o&&(o=o.replace(/\+/g," ")),t[n]=o}return t})()}};const l="data-component",a=e=>({name:e.getAttribute(l),element:e,parent:null,children:[],siblings:[]});let u=1;const f=(e,t)=>{const n=new t,{name:o,element:r,parent:s,children:c,siblings:i}=e;return n.element=r,n.node={name:o,element:r,parent:s,children:c,siblings:i},n.componentId=""+u++,n},p=(e,t)=>{e.setAttribute("data-component-id",t.componentId),e.instance=t},d=e=>1===e.length?e[0]:e;var m=(e={})=>{const t=e.root??document.body,n=Array.isArray(e.components)?e.components:[],o=(e=>{const t=(e=>{const t=Array.from(e.querySelectorAll(`[${l}]`));return e instanceof Element&&e.hasAttribute(l)&&!t.includes(e)&&t.unshift(e),t})(e),n=t.map(e=>a(e)),o=new Map;for(const e of n)o.set(e.element,e);for(const e of t){const t=o.get(e),n=e.parentElement?.closest(`[${l}]`);if(n&&o.has(n)){const e=o.get(n);t.parent=e,e.children.push(t)}}const r=n.filter(e=>null===e.parent);for(const e of r)e.siblings=r.filter(t=>t!==e);return n})(t);((e,t)=>{if(0===e.length)throw new Error("No component elements found in the root element");for(const e of t){const t=e.prototype?.constructor?.name||e.constructor?.name||"(anonymous)",n=Object.getOwnPropertyDescriptor(e,"name");if("string"!=typeof e.name||0===e.name.length||!n||!0!==n.writable)throw new Error(`Invalid component class: missing static name (${t})`)}const n=new Set(e.map(e=>e.name)),o=new Set(t.map(e=>e.name));for(const e of n)if(!o.has(e))throw new Error(`Found data-component="${e}" but no matching class passed to start({ components })`)})(o,n);const r=((e,t)=>{const n=[];for(const o of t)for(const t of e){if(t.name!=o.name)continue;const e=f(t,o);p(t.element,e),n.push(e)}for(const e of n)"function"==typeof e.connect&&e.connect();return n})(o,n);((e,t)=>{const n=new Map;for(const e of t)n.set(e.name,e);const o=new MutationObserver(e=>{const t=(e=>{const t=new Set;for(const n of e)for(const e of n.addedNodes)e instanceof Element&&(e.hasAttribute(l)&&t.add(e),e.querySelectorAll?.(`[${l}]`).forEach(e=>t.add(e)));return t})(e);if(0===t.size)return;const o=((e,t)=>Array.from(e).filter(e=>{const n=e.getAttribute(l);return t.has(n)&&!e.instance}))(t,n);if(0===o.length)return;const r=((e,t)=>{const n=new Array;for(const o of e){const e=o.getAttribute(l),r=t.get(e);if(!r)continue;const s=a(o),c=f(s,r);p(o,c),n.push(c)}return n})(o,n);for(const e of r){const t=e.element.parentElement?.closest(`[${l}]`);if(t){const n=t.instance;n&&e.addParent(n)}for(const t of r){if(t.element===e.element)continue;const n=t.element.parentElement?.closest(`[${l}]`);n===e.element&&(e.node.children.push(t.node),t.node.parent=e.node)}}for(const e of r)"function"==typeof e.connect&&e.connect()});o.observe(e,{childList:!0,subtree:!0})})(t,n);const s=r.filter(e=>null===e.node.parent);return d(s)};class h{constructor(){this._cleanupCallbacks=[],this._isDisconnected=!1}addParent(e){this.node.parent=e.node,e.node.children.push(this.node)}registerCleanup(e){return"function"==typeof e&&this._cleanupCallbacks.push(e),e}on(e,t,n,o){e.addEventListener(t,n,o);const r=()=>e.removeEventListener(t,n,o);return this.registerCleanup(r),r}timeout(e,t){const n=setTimeout(e,t);return this.registerCleanup(()=>clearTimeout(n)),n}interval(e,t){const n=setInterval(e,t);return this.registerCleanup(()=>clearInterval(n)),n}disconnect(){if(this._isDisconnected)return;this._isDisconnected=!0;const e=this._cleanupCallbacks.splice(0);for(const t of e)t()}ref(e){const t=Array.from(this.element.querySelectorAll(`[data-ref="${e}"]`));return d(t)}refs(){const e={};this.element.querySelectorAll("[data-ref]").forEach(t=>{const n=t.getAttribute("data-ref");e[n]||(e[n]=[]),e[n].push(t)});const t={};return Object.keys(e).forEach(n=>{t[n]=d(e[n])}),t}parent(){return this.node.parent?.element.instance}children(e){let t=this.node.children;return e&&(t=t.filter(t=>t.name===e)),t.map(e=>e.element.instance)}siblings(e){return this.node.siblings.filter(t=>t.name===e).map(e=>e.element.instance)}}return t}()});
//# sourceMappingURL=loco-core.js.map