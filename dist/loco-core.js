!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("LocoCore",[],e):"object"==typeof exports?exports.LocoCore=e():t.LocoCore=e()}(window,function(){return function(){"use strict";var t={d:function(e,n){for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r:function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Component:function(){return d},helpers:function(){return a},init:function(){return s},start:function(){return p}});let n=null,o=null;const r=(t,e)=>{"function"==typeof t.constructor[e]&&t.constructor[e](),"function"==typeof t[e]&&t[e]()},c=(t,e,n)=>{const o=void 0===n?t[e]:t[e][n];return"function"==typeof o?new o:"object"==typeof o?o:null};var s=t=>{const e=document.getElementsByTagName("body")[0],s=e.getAttribute("data-namespace"),a=e.getAttribute("data-controller"),l=e.getAttribute("data-action");return null!==o&&(r(o,"deinitialize"),o=null),null!==n&&(r(n,"deinitialize"),n=null),n=c(t,s),o=c(t,a),null!==n&&(o=c(t,s,a),n.controller=o,r(n,"initialize")),null!==o&&(o.namespaceController=n,r(o,"initialize"),r(o,l)),{namespaceController:n,controller:o,action:l}},a={get params(){return((t=window.location.href)=>{const e={},n=/https?:\/\/.+\/\w+\/(\d+)/.exec(t),o=null!==n?n[1]:null;null!==o&&(e.id=parseInt(o));const r=t.split("?");if(1===r.length)return e;const c=r[r.length-1].split("&").map(t=>t.split("="));for(const t of c){let n=decodeURIComponent(t[0]),o=decodeURIComponent(t[1]);"string"==typeof o&&(o=o.replace(/\+/g," ")),e[n]=o}return e})()}};const l="data-component";let i=1;const u=()=>""+i++,f=new WeakMap;var p=(t={})=>{const e=t.root??document.body,n=Array.isArray(t.components)?t.components:[],o=(t=>{const e=Array.from(t.querySelectorAll(`[${l}]`));return t instanceof Element&&t.hasAttribute(l)&&!e.includes(t)&&e.unshift(t),e})(e);((t,e)=>{if(0===t.length)throw new Error("No component elements found in the root element");for(const t of e){const e=(t&&t.prototype&&t.prototype.constructor?t.prototype.constructor.name:null)||(t&&t.constructor?t.constructor.name:null)||"(anonymous)",n=Object.getOwnPropertyDescriptor(t,"name");if("string"!=typeof t?.name||0===t.name.length||!n||!0!==n.writable)throw new Error(`Invalid component class: missing static name (${e})`)}const n=new Set(Array.from(t,t=>t.getAttribute("data-component"))),o=new Set((Array.isArray(e)?e:[]).map(t=>"string"==typeof t?.name?t.name:null).filter(Boolean));for(const t of n)if(!o.has(t))throw new Error(`Found data-component="${t}" but no matching class passed to start({ components })`)})(o,n);const r=(t=>{const e=new Map;for(const n of t){const t=n.getAttribute(l);e.set(n,{name:t,element:n,parent:null,children:[]})}for(const n of t){const t=e.get(n),o=n.parentElement?.closest(`[${l}]`);if(o&&e.has(o)){const n=e.get(o);t.parent=n,n.children.push(t)}}return e})(o);((t,e)=>{for(const n of e){const e="string"==typeof n?.name?n.name:null;if(!e)continue;const o=[];for(const n of t.values())n.name===e&&o.push(n);for(const t of o){const e=new n;e.element=t.element;const o={...t};delete o.name,delete o.element,e.node=o,e.componentId=u(),t.element.setAttribute("data-component-id",e.componentId),t.element.instance=e,"function"==typeof e.connect&&e.connect()}}})(r,n),((t,e)=>{const n=new Map;for(const t of e)n.set(t.name,t);const o=new MutationObserver(t=>{const e=new Set;for(const n of t)for(const t of n.addedNodes)t instanceof Element&&(t.hasAttribute("data-component")&&e.add(t),t.querySelectorAll?.("[data-component]").forEach(t=>e.add(t)));if(0===e.size)return;const o=Array.from(e).filter(t=>{const e=t.getAttribute("data-component");return n.has(e)&&!t.instance});if(0===o.length)return;const r=new Map;for(const t of o){const e=t.getAttribute("data-component"),o=n.get(e);if(!o)continue;const c=new o;c.element=t,c.node={parent:null,children:[]},c.componentId=u(),t.setAttribute("data-component-id",c.componentId),t.instance=c,r.set(t,c)}for(const t of o){const e=r.get(t);if(!e)continue;const n=t.parentElement?.closest("[data-component]");if(n){const t=r.get(n)||n.instance;t&&t.node&&(e.node.parent=t.node,t.node.children.push(e.node))}for(const n of o){if(n===t)continue;const o=n.parentElement?.closest("[data-component]");if(o===t){const t=r.get(n);t&&(e.node.children.push(t.node),t.node.parent=e.node)}}}for(const t of r.values())"function"==typeof t.connect&&t.connect()});o.observe(t,{childList:!0,subtree:!0}),f.set(t,{observer:o,classByName:n})})(e,n);const c=[];return c.push(...Array.from(r.values()).filter(t=>null===t.parent)),c};class d{constructor(){this._cleanupCallbacks=[],this._isDisconnected=!1}registerCleanup(t){return"function"==typeof t&&this._cleanupCallbacks.push(t),t}on(t,e,n,o){t.addEventListener(e,n,o);const r=()=>t.removeEventListener(e,n,o);return this.registerCleanup(r),r}timeout(t,e){const n=setTimeout(t,e);return this.registerCleanup(()=>clearTimeout(n)),n}interval(t,e){const n=setInterval(t,e);return this.registerCleanup(()=>clearInterval(n)),n}disconnect(){if(this._isDisconnected)return;this._isDisconnected=!0;const t=this._cleanupCallbacks.splice(0);for(const e of t)e()}ref(t){const e=Array.from(this.element.querySelectorAll(`[data-ref="${t}"]`));return 0===e.length?[]:1===e.length?e[0]:e}refs(){const t={};this.element.querySelectorAll("[data-ref]").forEach(e=>{const n=e.getAttribute("data-ref");t[n]||(t[n]=[]),t[n].push(e)});const e={};return Object.keys(t).forEach(n=>{const o=t[n];e[n]=1===o.length?o[0]:o}),e}}return e}()});
//# sourceMappingURL=loco-core.js.map