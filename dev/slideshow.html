<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Modest > Slideshow</title>
  </head>
  <body>
    <h1>Modest > Slideshow</h1>

    <h2>Slideshow</h2>
    <div data-component="slideshow">
      <button data-ref="previous"> â† </button>
      <button data-ref="next"> â†’ </button>

      <div data-component="slide">ğŸµ #1</div>
      <div data-component="slide">ğŸ™ˆ #2</div>
      <div data-component="slide">ğŸ™‰ #3</div>
      <div data-component="slide">ğŸ™Š #4</div>
    </div>

    <h2>Slideshow Manager</h2>
    <div data-component="slideshow-manager">
      <button data-ref="add-slide">Add slide</button>
      <button data-ref="show-slides">Show slides</button>
      <button data-ref="hide-slides">Hide slides</button>
    </div>

    <script src="/loco-core.js"></script>
    <script>
      const { start, Component } = LocoCore;

      class Slide extends Component {
        static name = "slide";

        show() {
          this.element.hidden = false;
        }

        hide() {
          this.element.hidden = true;
        }
      }

      class Slideshow extends Component {
        static name = "slideshow";

        constructor() {
          super();
          this.index = 0;
        }

        get slidesNumber() {
          return this.children().length;
        }

        connect() {
          this.on(this.ref("previous"), "click", () => this.#changeIndex(-1));
          this.on(this.ref("next"), "click", () => this.#changeIndex(1));
          this.hideSlides();
        }

        addSlide(slide) {
          this.element.appendChild(slide);
        }

        showSlides() {
          this.ref("slide").forEach((slide) => slide.hidden = false);
        }

        hideSlides() {
          this.children().forEach((slide, index) => {
            (index === this.index) ? slide.show() : slide.hide();
          });
        }

        #changeIndex(diff = 0) {
          this.index += diff;
          if (this.index >= this.slidesNumber) {
            this.index = 0;
          }
          if (this.index < 0) {
            this.index = this.slidesNumber - 1;
          }
          this.hideSlides();
        }
      }

      class SlideshowManager extends Component {
        static name = "slideshow-manager";

        connect() {
          this.on(this.ref("add-slide"), "click", () => this.#addSlide());
          this.on(this.ref("show-slides"), "click", () => this.#showSlides());
          this.on(this.ref("hide-slides"), "click", () => this.#hideSlides());
        }

        #addSlide() {
          const slidesNumber = this.siblings("slideshow").slidesNumber;
          const slide = document.createElement("div");
          slide.dataset.ref = "slide";
          slide.textContent = `ğŸ’ #${slidesNumber + 1}`;
          slide.hidden = true;
          this.siblings("slideshow").addSlide(slide);
        }

        #showSlides() {
          this.siblings("slideshow").showSlides();
        }

        #hideSlides() {
          this.siblings("slideshow").hideSlides();
        }
      }

      const app = start({ components: [Slide, Slideshow, SlideshowManager] });
    </script>

    <p>
      <a href="/">Modest</a>
    </p>
  </body>
</html>
